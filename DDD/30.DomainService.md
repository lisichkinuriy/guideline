# DomainService

существуют операции, которые требуют на входе множество Entity.  
Их реализуем в stateless классах DomainService  
сами операции - pure function, это позволяет писать unit тесты 

пример
```php
class DebtService
{
    /**
     * @param Collection<int, EmployeeRequisite> $active_requisites
     * @param Collection<int, Commission> $unpaid_commissions
     */
    public static function getPermissionDTO(
        Collection $active_requisites,
        Collection $unpaid_commissions,
        CommissionSettings $commissionSettings
    ): PayoutPermissionDTO {
        // Выплата запрещена если:
        // есть долг
        // расчёт комиссии включен, но реквизитов для выплаты нет

        if (false === $unpaid_commissions->isEmpty()) {
            return PayoutPermissionDTO::debt();
        }

        if ($commissionSettings->isActive()
            && $active_requisites->isEmpty()) {
            return PayoutPermissionDTO::noRequisites();
        }

        return PayoutPermissionDTO::allowed();
    }
}
```

пример юнит теста
```php
public function test_debt_domain_service()
{
    $agent = Agent::new(AgentID::fake());
    $agent->setProcessingId(ProcessingReceiverID::fake());
    $employee = Employee::new(GatewayEmployeeID::fake());

    $permission = DebtService::getPermissionDTO(collect(), collect(), CommissionSettings::fake());
    $this->assertFalse($permission->isAllowed());

    $permission = DebtService::getPermissionDTO(collect(), collect(), CommissionSettings::fake(active: false));
    $this->assertTrue($permission->isAllowed());

    $unpaid_commissions = collect([Commission::fake(employeeID: $employee->getId())]);
    $permission = DebtService::getPermissionDTO(collect(), $unpaid_commissions, CommissionSettings::fake());
    $this->assertFalse($permission->isAllowed());
    $this->assertTrue($permission->isDebt());

    $r1 = EmployeeRequisite::fake(employee_id: $employee->getId())->fakeActive();
    $r2 = EmployeeRequisite::fake(employee_id: $employee->getId(), lastRequisite: $r1)->fakeActive();
    $active_requisites = collect([$r1, $r2]);

    $permission = DebtService::getPermissionDTO($active_requisites, $unpaid_commissions, CommissionSettings::fake());
    $this->assertFalse($permission->isAllowed());
    $this->assertTrue($permission->isDebt());

    $permission = DebtService::getPermissionDTO($active_requisites, collect(), CommissionSettings::fake());
    $this->assertTrue($permission->isAllowed());
}
```