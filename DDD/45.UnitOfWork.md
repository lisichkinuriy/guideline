# UnitOfWork

Наша работа состоит из:
- выборки данных через репозиторий
- внесения изменений в данные через слой Domain
- сохранения данных через UnitOfWork


UOW это единая точка сохранения изменений в базу данных.
- сохраняет модельки
- в той же транзакции БД диспетчит необходимые джобы

позволяет
- получить единую точку внесения изменений в БД
- соблюсти транзакционность операций
- отвязаться от базы данных в юнит тестах.

использование в Action:
```php
class SetCommissionSettingsAction implements IAction
{
    public function __construct(
        public IUnitOfWork $uow,
        public ICommissionSettingsRepository $settingsRepository) {
    }

    public static function mock(?CommissionSettings $settings = null)
    {
        FakeUnitOfWork::bind();
        CommissionSettingsRepositoryMock::bind($settings);
    }

    public function execute(SetCommissionSettingsDTO $dto): ActionResultDTO
    {
        $settings = $this->settingsRepository->getForEmployer($this->dto->employerName);
        $settings->doSomethingPoleznogoAndChangeState();
        
        $uow->add($settings);
        $uow->addDispatchable(CPAReportJob::class, $settings)
        $uow->commit();
        
        ... bla bla return
    }
}
```