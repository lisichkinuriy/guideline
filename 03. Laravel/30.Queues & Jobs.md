# Queues & Jobs

- Именуем все очереди в Enum QueueName
- Названия очередям даём в терминах предметной области.  Плохо - new_queue,  Хорошо - salary
- Используем трейт JobAction для тестирования
- Не забываем про ShouldBeUnique, таймауты, бэкоффы и т.п.
- зона ответственности Джобы - запуск/перезапуск Action


Плохой пример
```php
class ProcessCommissionJob implements ShouldQueue
{
    use Queueable;   
       
    public function __construct(public CommissionID $commissionID)
    {
    }

    public function handle(): void
    {
         ... а здесь идёт портянка кода
    }
}
```

Хороший пример
```php
class ProcessCommissionJob implements ShouldQueue, ShouldBeUnique
{
    use Queueable;
    use JobAction;
       
    public int $tries = 3;
    public int $backoff = 60*10;
    public int $timeout = 25;       
    
    public int $uniqueFor = 60 * 60 * 24;
    
    public function uniqueId(): string {
        return $this->commissionID->value;
    }
       
    public function __construct(public CommissionID $commissionID)
    {
        $this->queue = QueueName::COMMISSION;
    }

    
    public function handle(): void
    {
        $action = new ProcessCommissionAction($this->commissionID);
        $this->executeActionAndProcessResult($action);
    }
}
```

Пример юнит теста
```php
    public function test_job(): void
    {
        ProcessCommissionJob::fake();

        $job = new ProcessCommissionJob(CommissionID::fake());
        $job->handle();

        $this->assertEquals(ProcessCommissionJob::getExecutedAction(), ProcessCommissionAction::class);
    }
```